<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="container">
        <section>
            <div class="head-line"> <img
                    src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT05OryiebhiD1LeusMMRv6VMZ2iJxnZNB6CQ&usqp=CAU"
                    alt=""></div>
            <div class="menus">
                <button>ë‚ ì”¨</button>
                <button>ë‰´ìŠ¤</button>
                <button>ë„ì„œ</button>
                <button>ìš´ë™</button>
                <button>ìŒì•…</button>
                <button>ìš”ë¦¬</button>
                <button>ì—¬í–‰</button>
            </div>

            <span>
                <input type="text" id="search-input">
                <button id="search-button">Go</button>
            </span>

            <section id="news-board">
                <div class="row">
                    <div class="col-lg-4">
                        <img class="news-img-size"
                            src="https://image.aladin.co.kr/product/28966/11/letslook/K292836721_b.jpg" alt="">
                    </div>
                    <div class="col-lg-8">
                        <h5> title ${item.title} </h5>
                        <p>${item.contents}</p>
                        <div>${item.datetime} </div>
                        <a href="${item.url}">ìƒì„¸ ë‰´ìŠ¤ë³´ê¸°</a>
                    </div>
                </div>
            </section>
            <nav aria-label="Page navigation example">
                <ul class="pagenation">

                </ul>
            </nav>
        </section>
    </div>

    <script>
        let news = [];
        let page = 1;
        let total_pages = 0;
        let menus = document.querySelectorAll(".menus button")
        menus.forEach(menu => menu.addEventListener("click", (event) => getNewsByTopic(event)))

        let searchButton = document.getElementById("search-button");
        let url;

        const getNews = async () => {
            try {
                let header = new Headers({ 'Authorization': 'KakaoAK ab44543239760acabf8e5a55b74860d5' });
                url.searchParams.set('page',page); //&page=ìˆ«ì
                console.log("urlì€?",url)
                let response = await fetch(url, { headers: header }) //fetchë¼ëŠ” í•¨ìˆ˜ ê¸°ë‹¤ë ¤ì£¼ëŠ” ê±°
                let data = await response.json();
                if (response.status == 200) {
                    news = data.documents;
                    total_pages = data.pageable_count;

                    console.log("ë°›ëŠ” ë°ì´í„°", data)
                    render();
                    pagenation();
                } else {
                    throw new Error(data.message)
                }

            } catch (error) {
                console.log("ì¡íŒ ì—ëŸ¬ëŠ”", error.message);
                errorRender(error.message);
            }
        };
        //ğŸ’›ğŸ§¡ì½”ë“œ ë¦¬íŒ©í† ë§
        //ê° í•¨ìˆ˜ì—ì„œ í•„ìš” urlë§Œë“ ë‹¤. (ì „ì—­ë³€ìˆ˜)
        //apií˜¸ì¶œ í•¨ìˆ˜ë¥¼ ë¶€ë¥¸ë‹¤.

        const getLatestNews = async () => { //ë¹„ë™ê¸° : ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ëŠ” ê²ƒ
            url = new URL(`https://dapi.kakao.com/v2/search/web?query=ë‰´ìŠ¤`);
            getNews();
        };

        const getNewsByTopic = async (event) => {
            let topic = event.target.textContent.toLowerCase();
            url = new URL(`https://dapi.kakao.com/v2/search/web?query=${topic}`)
            getNews();
        };

        const getNewsByKeyword = async () => { //í™”ì‚´í‘œ í•¨ìˆ˜ ì •ì˜
            //1. ê²€ìƒ‰ í‚¤ì›Œë“œ ì½ì–´ì˜¤ê¸°
            //2. urlì— ê²€ìƒ‰ í‚¤ì›Œë“œ ë¶™ì´ê¸°
            //3. í—¤ë”ì¤€ë¹„
            //4. url ë¶€ë¥´ê¸°
            //5. ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            //6. ë°ì´í„° ë³´ì—¬ì£¼ê¸°

            let keyword = document.getElementById("search-input").value;
            url = new URL(`https://dapi.kakao.com/v2/search/web?query=${keyword}&size=5`);
            getNews();
        }

        const render = () => {
            let newsHTML = news.map(item => {
                return `<div class="row">
                    <div class="col-lg-4">
                        <img class="news-img-size" src="https://image.aladin.co.kr/product/28966/11/letslook/K292836721_b.jpg" alt="">
                    </div>
                    <div class="col-lg-8">
                        <h5> ${item.title} </h5>
                        <p>${item.contents}</p>
                        <div>${item.datetime} <a href="${item.url}">ìƒì„¸ ë‰´ìŠ¤ë³´ê¸°</a></div>
                    </div>
                </div>`;
            }).join('');

            document.getElementById("news-board").innerHTML = newsHTML;
        };

        const errorRender = (message) => {
            let errorHTML = `<div>${message}</div>`
            document.getElementById("news-board").innerHTML = errorHTML;
        }

        searchButton.addEventListener("click", getNewsByKeyword); //ìœ„ì¹˜. í™”ì‚´í‘œí•¨ìˆ˜ í˜¸ì´ìŠ¤íŒ…x í•¨ìˆ˜ ì •ì˜ë˜ê¸° ì „ì— ì“¸ ìˆ˜ ì—†ë‹¤.
        getLatestNews();

        const pagenation = () => {
            let pagenationHTML = ``;
            //total_page
            //page
            //page group
            let pageGroup = Math.ceil(page / 5);
            //last
            let last = pageGroup * 5;
            //first
            let first = last - 4;
            //first~last í˜ì´ì§€ í”„ë¦°íŠ¸

            pagenationHTML = `<li class="page-item">
                    <a class="page-link" href="#" aria-label="Previous">
                        <span aria-hidden="true" onclick="moveToPage(${page.first})">&laquo;</span>
                    </a>
                    </li><li class="page-item">
                    <a class="page-link" href="#" aria-label="Previous" onclick="moveToPage(${page-1})">
                        <span aria-hidden="true">&lt;</span>
                    </a>
                    </li>`;
            for (let i = first; i <= last; i++) {
                pagenationHTML += `<li class="page-item ${page==i?"active":""}"><a class="page-link" href="#" onclick="moveToPage(${i})">${i}</a></li>`;
            }
            pagenationHTML += `<li class="page-item">
                <a class="page-link" href="#" aria-label="Next" onclick="moveToPage(${page+1})">
                    <span aria-hidden="true">&gt;</span>
                </a>
                </li>
                <li class="page-item">
                <a class="page-link" href="#" aria-label="Next">
                    <span aria-hidden="true" onclick="moveToPage(${page.last})">&raquo;</span>
                </a>
                </li>`;
            
            document.querySelector(".pagenation").innerHTML = pagenationHTML;
        };

        const moveToPage = (pageNum) => {
            //1. ì´ë™í•˜ê³  ì‹¶ì€ í˜ì´ì§€ë¥¼ ì•Œì•„ì•¼í•œë‹¤.
            page = pageNum;
            console.log(page);
            //2. ì´ë™í•˜ê³  ì‹¶ì€ í˜ì´ì§€ë¥¼ ê°€ì§€ê³  apië¥¼ ë‹¤ì‹œ í˜¸ì¶œ
            url = new URL(`https://dapi.kakao.com/v2/search/web?query=ë‰´ìŠ¤`);
            getNews();
        }


    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <!--moment-->
</body>

</html>